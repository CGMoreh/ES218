<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Re-expressing values</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39623718-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-39623718-2');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03ab_groupby.html">Grouping and summarizing tables</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03ab_examples.html">Example of data manipulation workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Misc01.html">R markdown documents</a>
    </li>
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Re-expressing values</h1>

</div>


<hr />
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: &#39;Source Code Pro&#39;, &#39;Open Sans&#39;;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
dplyr
</th>
<th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: &#39;Source Code Pro&#39;, &#39;Open Sans&#39;;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
ggplot2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: &#39;Open Sans&#39;, Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
0.8.3
</td>
<td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: &#39;Open Sans&#39;, Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
3.2.1
</td>
</tr>
</tbody>
</table>
<hr />
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Datasets do not always follow a nice symmetrical distribution nor do their spreads behave systematically across different levels (e.g. medians). Such distributions do not lend themselves well to visual exploration since they can mask simple patterns. They can also be a problem when testing hypotheses using traditional statistical procedures. A solution to this problem is non-linear <strong>re-expression</strong> (aka transformation) of the values. In univariate analysis, we often seek to <strong>symmetrize</strong> the distribution and/or <strong>equalize</strong> the spread. In multivariate analysis, the objective is to usually <strong>linearize</strong> the relationship between variables and/or to <strong>normalize</strong> the residual in a regression model.</p>
<img src="img/Reexpression_properties.png" />
</p>
<p>One popular form of re-expression is the <strong>log</strong> (natural or base 10). The other is the family of power transformations (of which the <em>log</em> is a special case) implemented using either the <strong>Tukey</strong> transformation or the <strong>Box-Cox</strong> transformation.</p>
</div>
<div id="the-log-transformation" class="section level1">
<h1>The log transformation</h1>
<p>One of the most popular transformations used in data analysis is the logarithm. The log, <span class="math inline">\(y\)</span>, of a value <span class="math inline">\(x\)</span> is the power to which the base must be raised to produce <span class="math inline">\(x\)</span>. This requires that the log function be defined by a <strong>base</strong>, <span class="math inline">\(b\)</span>, such as <code>10</code>, <code>2</code> or <code>exp(1)</code> (the latter defining the natural log).</p>
<p><span class="math display">\[
y = log_b(x) \Leftrightarrow  x=b^y 
\]</span></p>
<p>In R, the base is defined by passing the parameter <code>base=</code> to the <code>log()</code> function as in <code>log(x , base=10)</code>.</p>
<p>Re-expressing with the log is particularly useful when the change in one value as a function of another is multiplicative and not additive. An example of such a dataset is the compounding interest. Let’s assume that we start off with $1000 in an investment account that yields 10% interest each year. We can calculate the size of our investment for the next 50 years as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">rate &lt;-<span class="st"> </span><span class="fl">0.1</span>                 <span class="co"># Rate is stored as a fraction</span></a>
<a class="sourceLine" id="cb1-2" title="2">y    &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="dv">50</span>) <span class="co"># Create an empty vector that can hold 50 values</span></a>
<a class="sourceLine" id="cb1-3" title="3">y[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1000</span>                <span class="co"># Start 1st year with $1000</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># Next, compute the investment ammount for years 2, 3, ..., 50.</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># Each iteration of the loop computes the new amount for year i based </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co"># on the previous year&#39;s amount (i-1).</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(y)){</a>
<a class="sourceLine" id="cb1-9" title="9">  y[i] &lt;-<span class="st"> </span>y[i<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>(y[i<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>rate)  <span class="co"># Or y[i-1] * (1 + rate)</span></a>
<a class="sourceLine" id="cb1-10" title="10">}</a></code></pre></div>
<p>The vector <code>y</code> gives us the amount of our investment for each year over the course of 50 years.</p>
<pre><code> [1]   1000.000   1100.000   1210.000   1331.000   1464.100   1610.510   1771.561   1948.717
 [9]   2143.589   2357.948   2593.742   2853.117   3138.428   3452.271   3797.498   4177.248
[17]   4594.973   5054.470   5559.917   6115.909   6727.500   7400.250   8140.275   8954.302
[25]   9849.733  10834.706  11918.177  13109.994  14420.994  15863.093  17449.402  19194.342
[33]  21113.777  23225.154  25547.670  28102.437  30912.681  34003.949  37404.343  41144.778
[41]  45259.256  49785.181  54763.699  60240.069  66264.076  72890.484  80179.532  88197.485
[49]  97017.234 106718.957</code></pre>
<p>We can plot the values as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Note that a scatter plot is created from 2 variables, however, if only one</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># is passed to the plot() function, R will assume that the x variable is</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># an equally spaced index.</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">plot</span>(y, <span class="dt">pch =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-5-1.png" width="384" /></p>
<p>The change in difference between values from year to year is <strong>not additive</strong>, in other words, the difference between years 48 and 49 is different than that for years 3 and 4.</p>
<table style="width:64%;">
<colgroup>
<col width="25%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Years</th>
<th align="center">Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>y[49] - y[48]</code></td>
<td align="center">8819.75</td>
</tr>
<tr class="even">
<td align="left"><code>y[4] - y[3]</code></td>
<td align="center">121</td>
</tr>
</tbody>
</table>
<p>However, the ratios between the pairs of years are identical:</p>
<table style="width:53%;">
<colgroup>
<col width="25%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Years</th>
<th align="center">Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>y[49] / y[48]</code></td>
<td align="center">1.1</td>
</tr>
<tr class="even">
<td align="left"><code>y[4] / y[3]</code></td>
<td align="center">1.1</td>
</tr>
</tbody>
</table>
<p>We say that the change in value is <em>multiplicative</em> across the years. In other words, the value amount 6 years out is <span class="math inline">\(value(6) = (yearly\_increase)^{6} \times 1000\)</span> or <code>1.1^6 * 1000</code> = 1771.561 which matches value <code>y[7]</code>.</p>
<p>When we expect a variable to change multiplicatively as a function of another variable, it is usually best to transform the variable using the logarithm. To see why, plot the log of <code>y</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">plot</span>(<span class="kw">log</span>(y), <span class="dt">pch=</span><span class="dv">20</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-6-1.png" width="384" /></p>
<p>Note the change from a curved line to a perfectly straight line. The logarithm will produce a straight line if the rate of change for <code>y</code> is constant over the range of <code>x</code>. This is a nifty property since it makes it so much easier to see if and where the rate of change differs. For example, let’s look at the population growth rate of the US from 1850 to 2013.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://personal.colby.edu/personal/m/mgimond/R/Data/Population.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">plot</span>(US <span class="op">~</span><span class="st"> </span>Year, dat, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>) </a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-7-1.png" width="384" /></p>
<p>The population count for the US follows a slightly curved (convex) pattern. It’s difficult to see from this plot if the rate of growth is consistent across the years (though there is an obvious jump in population count around the 1950’s). Let’s log the population count.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">plot</span>(<span class="kw">log</span>(US) <span class="op">~</span><span class="st"> </span>Year, dat, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)  </a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-8-1.png" width="384" /></p>
<p>It’s clear from the log plot that the rate of growth for the US has not been consistent over the years (had it been consistent, the line would have been straight). In fact, there seems to be a gradual decrease in growth rate over the 150 year period (though a more thorough analysis would be needed to see where and when the growth rates changed).</p>
<p>A logarithm is defined by a base. Some of the most common bases are <code>10</code>, <code>2</code> and <code>exp(1)</code> with the latter being the natural log. The bases can be defined in the call to <code>log()</code> by adding a second parameter to that function. For example, to apply the log base 2 to the 5<sup>th</sup> value of the vector <code>y</code>, type <code>log( y[5], 2)</code>. To apply the natural log to that same value, simply type <code>log( y[5], exp(1))</code>. If you don’t specify a base, <code>R</code> will default to the natural log.</p>
<p>The choice of a log base will not impact the shape of the logged values in the plot, only in its absolute value. So unless interpretation of the logged value is of concern, any base will do. Generally, you want to avoid difficult to interpret logged values. For example, if you apply log base 10 to the investment dataset, you will end up with a smaller range of values thus more decimal places to work with whereas a base 2 logarithm will generate a wider range of values and thus fewer decimal places to work with.</p>
<p><img src="Week08a_files/figure-html/unnamed-chunk-9-1.png" width="576" /></p>
<p>A rule of thumb is to use log base 10 when the range of values to be logged covers 3 or more powers of ten, <span class="math inline">\(\geq 10^3\)</span> (for example, a range of 5 to 50,000); if the range of values covers 2 or fewer powers of ten, <span class="math inline">\(\leq 10^2\)</span>(for example, a range of 5 to 500) then a natural log or a log base 2 log is best.</p>
</div>
<div id="the-tukey-transformation" class="section level1">
<h1>The Tukey transformation</h1>
<p>The Tukey family of transformations offers a broader range of re-expression options (which includes the log). The values are re-expressed using the algorithm:</p>
<p><span class="math display">\[
\begin{equation} T_{Tukey} = 
\begin{cases} x^p , &amp; p \neq  0 \\
              log(x), &amp; p = 0  
\end{cases}
\end{equation}
\]</span> The objective is to find a value for <span class="math inline">\(p\)</span> from a “ladder” of powers (e.g. -2, -1, -1/2, 0, 1/2, 1, 2) that does a good job in re-expressing the batch of values. Technically, <span class="math inline">\(p\)</span> can take on any value. But in practice, we normally pick a value for <span class="math inline">\(p\)</span> that may be “interpretable” in the context of our analysis. For example, a log transformation (<code>p=0</code>) may make sense if the process we are studying has a steady growth rate. A cube root transformation (p = 1/3) may make sense if the entity being measured is a volume (e.g. rain fall measurements). But sometimes, the choice of <span class="math inline">\(p\)</span> may not be directly interpretable or may not be of concern to the analyst.</p>
<p>A nifty solution to finding an appropriate <span class="math inline">\(p\)</span> is to create a function whose input is the vector (that we want to re-express) and a <span class="math inline">\(p\)</span> parameter we want to explore.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">RE &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">p =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="cf">if</span>(p <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb7-3" title="3">    z &lt;-<span class="st"> </span>x<span class="op">^</span>p</a>
<a class="sourceLine" id="cb7-4" title="4">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-5" title="5">    z &lt;-<span class="st"> </span><span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb7-6" title="6">  }</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="kw">return</span>(z)</a>
<a class="sourceLine" id="cb7-8" title="8">}</a></code></pre></div>
<p>To use the custom function <code>RE</code> simply pass two vectors: the batch of numbers being re-expressed and the <span class="math inline">\(p\)</span> parameter.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Create a skewed distribution of 50 random values</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">set.seed</span>(<span class="dv">9</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">a &lt;-<span class="st"> </span><span class="kw">rgamma</span>(<span class="dv">50</span>, <span class="dt">shape =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co"># Let&#39;s look at the skewed distribution</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">boxplot</span>(a, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-11-1.png" width="288" /></p>
<p>The batch is strongly skewed to the right. Let’s first try a square-root transformation (<code>p=1/2</code>)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">a.re &lt;-<span class="st"> </span><span class="kw">RE</span>(a, <span class="dt">p =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)   </a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">boxplot</span>(a.re, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-12-1.png" width="288" /></p>
<p>That certainly helps minimize the skew, but the distribution still lacks symmetry. Let’s try a log transformation (<code>p=0</code>):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">a.re &lt;-<span class="st"> </span><span class="kw">RE</span>(a, <span class="dt">p =</span> <span class="dv">0</span>)   </a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">boxplot</span>(a.re, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-13-1.png" width="288" /></p>
<p>That’s a little too much over-correction; we don’t want to substitute a right skew for a left skew. Let’s try a power in between (i.e. <code>p=1/4</code>):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">a.re &lt;-<span class="st"> </span><span class="kw">RE</span>(a, <span class="dt">p =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)   </a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">boxplot</span>(a.re, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-14-1.png" width="288" /></p>
<p>That’s much better. The distribution is now nicely balanced about its median.</p>
</div>
<div id="the-box-cox-transformation" class="section level1">
<h1>The Box-Cox transformation</h1>
<p>Another family of transformations is the Box-Cox transformation. The values are re-expressed using a modified version of the Tukey transformation:</p>
<p><span class="math display">\[
\begin{equation} T_{Box-Cox} = 
\begin{cases} \frac{x^p - 1}{p}, &amp; p \neq  0 \\
              log(x), &amp; p = 0 
\end{cases}
\end{equation}
\]</span> Just as we can create a custom Tukey transformation function, we can create a Box-Cox transformation function too:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">BC &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">p =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="cf">if</span>(p <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb12-3" title="3">    z &lt;-<span class="st"> </span><span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb12-4" title="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb12-5" title="5">    z &lt;-<span class="st"> </span>(x<span class="op">^</span>p <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>p</a>
<a class="sourceLine" id="cb12-6" title="6">  }</a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="kw">return</span>(z)</a>
<a class="sourceLine" id="cb12-8" title="8">}</a></code></pre></div>
<p>While both the Box-Cox and Tukey transformations method will generate similar distributions when the power <code>p</code> is <code>0</code> or greater, they will differ in distributions when the power is negative. For example, when re-expressing <code>mtcars$mpg</code> using an inverse power (p = -1), Tukey’s re-expression will change the data order but the Box-Cox transformation will not as shown in the following plots:.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">plot</span>(mpg <span class="op">~</span><span class="st"> </span>disp, mtcars, <span class="dt">main =</span> <span class="st">&quot;Original data&quot;</span>)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(<span class="kw">RE</span>(mtcars<span class="op">$</span>mpg, <span class="dt">p =</span> <span class="dv">-1</span>) <span class="op">~</span><span class="st"> </span>mtcars<span class="op">$</span>disp, <span class="dt">main =</span> <span class="st">&quot;Tukey&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">plot</span>(<span class="kw">BC</span>(mtcars<span class="op">$</span>mpg, <span class="dt">p =</span> <span class="dv">-1</span>) <span class="op">~</span><span class="st"> </span>mtcars<span class="op">$</span>disp, <span class="dt">main =</span> <span class="st">&quot;Box-Cox&quot;</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-16-1.png" width="576" /></p>
<p>The original data shows a negative relationship between <code>mpg</code> and <code>disp</code>; the Tukey re-expression takes the inverse of <code>mpg</code> which changes the nature of the relationship between the y and x variables where whe have a positive relationship between the re-expressed <code>mpg</code> variable and <code>disp</code> variable (note that by simply changing the sign of the re-expressed value, <code>-x^(-1)</code> maintains the nature of the original relationship); the Box-Cox transformation, on the other hand, maintains this negative relationship.</p>
<p>The choice of re-rexpression will depend on the analysis context. For example, if you want an easily interpretable transformation then opt for the Tukey re-expression. If you want to compare the shape of transformed variables, the Box-Cox approach will be better suited.</p>
</div>
<div id="re-expressing-to-stabilize-spread" class="section level1">
<h1>Re-expressing to stabilize spread</h1>
<p>A spread vs level plot not only tells us if there is a systematic relationship between spread and level, it can also suggest the power transformation to use. Note that the s-l method discussed here is not the one presented in Cleveland’s book (see the section titled “Spread-location plot” on the course website for an alternative version of the plot).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb14-2" title="2">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/Food_web.csv&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co"># Create s-l table </span></a>
<a class="sourceLine" id="cb14-5" title="5">df.sl &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(dimension) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">med  =</span> <span class="kw">log</span>(<span class="kw">median</span>(mean.length)),</a>
<a class="sourceLine" id="cb14-8" title="8">            <span class="dt">IQR  =</span> <span class="kw">IQR</span>(mean.length),  </a>
<a class="sourceLine" id="cb14-9" title="9">            <span class="dt">sprd =</span> <span class="kw">log</span>(IQR))</a>
<a class="sourceLine" id="cb14-10" title="10"></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co"># Plot spread vs median</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="kw">plot</span>(sprd <span class="op">~</span><span class="st"> </span>med, df.sl, <span class="dt">pch =</span> <span class="dv">16</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-17-1.png" width="211.2" /></p>
<p>The plot suggests a monotonic relationship between spread and median. Next, we’ll fit a line to this scatter plot and compute its slope. We’ll use the <code>lm()</code> function, but note that any other line fitting strategies could be used as well.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">plot</span>(sprd <span class="op">~</span><span class="st"> </span>med, df.sl, <span class="dt">pch =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co"># Run regression model</span></a>
<a class="sourceLine" id="cb15-4" title="4">M &lt;-<span class="st"> </span><span class="kw">lm</span>(sprd <span class="op">~</span><span class="st"> </span>med, df.sl)</a>
<a class="sourceLine" id="cb15-5" title="5"><span class="kw">abline</span>(M, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-18-1.png" width="211.2" /></p>
<p>The slope can be used to come up with the best power transformation to minimize the systematic increase in spread: <span class="math inline">\(p = 1 - slope\)</span>.</p>
<p>The slope can be extracted from the model <code>M</code> using the <code>coef</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"> <span class="kw">coef</span>(M)</a></code></pre></div>
<pre><code>(Intercept)         med 
  -3.003785    2.969673 </code></pre>
<p>The second value in the output is the slope. So the power to use is <code>1 - 2.97</code> or <code>-1.97</code>. We will use the power transformation function <code>BC</code> to re-express the <code>mean.length</code> values. We’ll add the re-expressed values as a new column to <code>df</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">df<span class="op">$</span>re.mean.length &lt;-<span class="st"> </span><span class="kw">BC</span>(df<span class="op">$</span>mean.length, <span class="fl">-1.97</span>)</a></code></pre></div>
<p>Let’s compare boxplots between the original values with the re-expressed values.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">boxplot</span>(mean.length <span class="op">~</span><span class="st"> </span>dimension, df, <span class="dt">main =</span> <span class="st">&quot;Original data&quot;</span>)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">boxplot</span>(re.mean.length <span class="op">~</span><span class="st"> </span>dimension, df, <span class="dt">main =</span> <span class="st">&quot;Re-expressed data&quot;</span>)</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-21-1.png" width="576" /></p>
<p>Recall that our goal here was to minimize any systematic relationship between spread and median. The re-expression seems to have equalized the spreads across the three groups.</p>
<p>We’ll check for a homogeneous spread across fitted medians using the original spread-level plot covered in last week’s <a href="./Week07b.html#constructing-the-s-l-plot">lecture</a>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb20-2" title="2">df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(dimension)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">Median =</span> <span class="kw">median</span>(re.mean.length),</a>
<a class="sourceLine" id="cb20-5" title="5">          <span class="dt">Residuals =</span> <span class="kw">sqrt</span>( <span class="kw">abs</span>( re.mean.length <span class="op">-</span><span class="st"> </span>Median)))   </a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="co"># Generate the s-l plot</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="kw">ggplot</span>(df1, <span class="kw">aes</span>(<span class="dt">x =</span> Median, <span class="dt">y =</span> Residuals)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>,<span class="dt">width =</span> <span class="fl">0.003</span>,<span class="dt">height =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun.y =</span> median, <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">sqrt</span>( <span class="kw">abs</span>( <span class="st">&quot; Residuals &quot;</span>)))) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Median, <span class="dt">y =</span> <span class="fl">0.6</span>, <span class="dt">label =</span> dimension) )</a></code></pre></div>
<p><img src="Week08a_files/figure-html/unnamed-chunk-22-1.png" width="307.2" /></p>
<p>The plot suggests that the re-expression does a good job in stabilizing the spread.</p>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2020)
</br>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
