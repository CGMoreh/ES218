<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tidying/reshaping tables using tidyr</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39623718-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-39623718-2');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


<link rel="stylesheet" href="libs/style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Introduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Week01.html">Course Introduction</a>
    </li>
    <li>
      <a href="The_R_environment.html">The R and RStudio environments</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03ab_groupby.html">Grouping and summarizing tables</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03ab_examples.html">Example of data manipulation workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Misc01.html">R markdown documents</a>
    </li>
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tidying/reshaping tables using tidyr</h1>

</div>


<hr />
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: &#39;Source Code Pro&#39;, &#39;Open Sans&#39;;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
tidyr
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: &#39;Open Sans&#39;, Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;">
1.1.2
</td>
</tr>
</tbody>
</table>
<hr />
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Data tables come in different sizes and shape; they can be a very simple two column dataset or they can consist of many columns and “sub-columns”. Understanding its structure, and learning how to reshape it into a workable form is critical to an effective and error free analysis.</p>
<p>For example, a median earnings data table downloaded from the U.S. census bureau’s website might look something like this:</p>
<p><img src="img/Typical_table.png" /></p>
<p>We are conditioned to think of a table as consisting of three components: rows, columns and data values. Implicit in this paradigm is that each column represents a unique attribute. However, this may not always be the case. For example, in the above table, each column represents two distinct variables: gender and educational attainment (two distinct sets of attributes).</p>
<p><img src="img/Anatomy_of_a_census_table.png" /></p>
<p>Another way of describing a dataset is by defining its <strong>variable(s)</strong>, <strong>values</strong> and <strong>observations</strong>. In the above example, we have four variables: gender, education, region and income. Each variable consists of either categorical values (e.g. region, gender and education) or numerical values (income).</p>
<p>An observation consists of a <strong>unique set</strong> of attribute <strong>values</strong>. For example the values <code>West Region</code>, <code>Female</code>, <code>Graduate</code> and <code>$57,914</code> make up <strong>one</strong> observation: there is just one instance of these combined values in the data. This perspective affords us another option in presenting the dataset: we can assign each column its own variable, and each row its own observation.</p>
<p><img src="img/Tidy_census.png" /></p>
<p>Note that each row of the table is part of a unique set of variable attributes. A dataset in this format may not be human “readable” (unlike its <em>wide</em> counterpart), but is the format of choice for many data analysis and visualization operations.</p>
<p>The next sections will demonstrate how one can convert a wide format to a long format and <em>vice versa</em>.</p>
</div>
<div id="wide-and-long-table-formats" class="section level1">
<h1>Wide and long table formats</h1>
<p>A 2014 Boston (Logan airport) flight data summary table will be used in this exercise. The summary displays average mean delay time (in minutes) by day of the work week and quarter.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">Weekday =</span> <span class="kw">c</span>( <span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tues&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thurs&quot;</span>, <span class="st">&quot;Fri&quot;</span> ),</span>
<span id="cb1-2"><a href="#cb1-2"></a>                  <span class="dt">Q1      =</span> <span class="kw">c</span>(  <span class="fl">9.9</span> ,  <span class="fl">4.9</span>  ,  <span class="fl">8.8</span> ,   <span class="fl">12.2</span> ,  <span class="fl">12.2</span> ),</span>
<span id="cb1-3"><a href="#cb1-3"></a>                  <span class="dt">Q2      =</span> <span class="kw">c</span>(  <span class="fl">5.4</span> ,  <span class="fl">9.7</span>  , <span class="fl">11.1</span> ,   <span class="fl">10.2</span> ,   <span class="fl">8.1</span> ),</span>
<span id="cb1-4"><a href="#cb1-4"></a>                  <span class="dt">Q3      =</span> <span class="kw">c</span>(  <span class="fl">8.8</span> ,  <span class="fl">7.9</span>  , <span class="fl">10.2</span> ,   <span class="fl">9.2</span>  ,   <span class="fl">7.9</span> ),</span>
<span id="cb1-5"><a href="#cb1-5"></a>                  <span class="dt">Q4      =</span> <span class="kw">c</span>(  <span class="fl">6.9</span> ,    <span class="dv">5</span>  ,  <span class="fl">9.3</span> ,   <span class="fl">9.7</span>  ,   <span class="fl">5.6</span> ) )</span></code></pre></div>
<p>Reshaping a table involves modifying its layout (or “shape”). In our example, <code>df</code> is in a “wide” format.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>df</span></code></pre></div>
<pre><code>  Weekday   Q1   Q2   Q3  Q4
1     Mon  9.9  5.4  8.8 6.9
2    Tues  4.9  9.7  7.9 5.0
3     Wed  8.8 11.1 10.2 9.3
4   Thurs 12.2 10.2  9.2 9.7
5     Fri 12.2  8.1  7.9 5.6</code></pre>
<p>There are three unique variables: day of week, quarter of year, and mean departure delay.</p>
<div id="creating-a-long-table-from-a-wide-table" class="section level2">
<h2>Creating a long table from a wide table</h2>
<p>A package that facilitates converting from wide to long (and <em>vice versa</em>) is <code>tidyr</code>. To go from wide to long we use the <code>pivot_longer</code> function. Note that if you are using a version of <code>tidyr</code> older than <code>1.0</code> you will want to use the <code>gather()</code> function..</p>
<p>The <code>pivot_longer</code> function takes three arguments:</p>
<ul>
<li><code>cols</code>: list of columns that are to be collapsed. The columns can be referenced by column number or column name.</li>
<li><code>names_to</code>: This is the name of the new column which will combine all column names (e.g. <code>Q1</code>, <code>Q2</code>, <code>Q3</code> and <code>Q4</code>).</li>
<li><code>values_to</code>: This is the name of the new column which will combine all column values (e.g. average delay times) associated with each variable combination.</li>
</ul>
<p>In our example, the line of code needed to re-express the table into a long form can be written in one of three ways:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb4-2"><a href="#cb4-2"></a>df.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df, <span class="dt">cols=</span><span class="dv">2</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">names_to =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Delay&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># or</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>df.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df, <span class="dt">cols=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">names_to =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Delay&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># or</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>df.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df, <span class="dt">cols=</span>Q1<span class="op">:</span>Q4, <span class="dt">names_to =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Delay&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># or</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>df.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df, <span class="dt">cols=</span><span class="kw">c</span>(Q1,Q2,Q3,Q4), <span class="dt">names_to =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Delay&quot;</span>)</span></code></pre></div>
<p>All three lines produce the same output, they differ only by how we are referencing the columns that are to be collapsed. Note that we assigned the names <code>Quarter</code> and <code>Delay</code> to the two new columns.</p>
<p>The first 10 lines of the output table are shown here. Note how each <code>Delay</code> value has its own row.</p>
<pre><code>   Weekday Quarter Delay
1      Mon      Q1   9.9
2     Tues      Q1   4.9
3      Wed      Q1   8.8
4    Thurs      Q1  12.2
5      Fri      Q1  12.2
6      Mon      Q2   5.4
7     Tues      Q2   9.7
8      Wed      Q2  11.1
9    Thurs      Q2  10.2
10     Fri      Q2   8.1</code></pre>
<p>The following figure summarizes the wide to long conversion.</p>
<p><img src="img/Tidyr_wide2long.png" /></p>
</div>
<div id="creating-a-wide-table-from-a-long-table" class="section level2">
<h2>Creating a wide table from a long table</h2>
<p>If a table is to be used for a visual assessment of the values, a long format may be difficult to work with. A long table can be re-expressed into a wide form by picking the two variables that will define the new column names and values.</p>
<p>Continuing with our example, we will convert <code>df.long</code> back to a wide format using the <code>pivot_wider()</code> function. This replaces the <code>spread()</code> function from earlier versions of tidyr (<code>&lt;1.0</code>). The <code>pivot_wider()</code> function takes at least two arguments:</p>
<ul>
<li><code>names_from</code>: Variable whose values will be converted to column names.</li>
<li><code>values_from</code>: Variable whose values will populate the table’s block of cell values.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>df.wide &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(df.long, <span class="dt">names_from =</span> Quarter, <span class="dt">values_from =</span> Delay) </span></code></pre></div>
<p>We’ve now recreated the wide version of our table.</p>
<pre><code># A tibble: 5 x 5
  Weekday    Q1    Q2    Q3    Q4
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Mon       9.9   5.4   8.8   6.9
2 Tues      4.9   9.7   7.9   5  
3 Wed       8.8  11.1  10.2   9.3
4 Thurs    12.2  10.2   9.2   9.7
5 Fri      12.2   8.1   7.9   5.6</code></pre>
<p>The following figure summarizes the long to wide conversion.</p>
<img src="img/Tidyr_long2wide.png" />
<p>
</p>
</div>
</div>
<div id="advanced-pivot_longer-options" class="section level1">
<h1>Advanced <code>pivot_longer</code> options</h1>
<p>Here’s a subset of median income by sex and by work experience for 2017.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&quot;Maine&quot;</span>, <span class="st">&quot;Massachusetts&quot;</span>, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                             <span class="st">&quot;New Hampshire&quot;</span>, <span class="st">&quot;Vermont&quot;</span>),</span>
<span id="cb8-3"><a href="#cb8-3"></a>                   <span class="dt">male_fulltime =</span> <span class="kw">c</span>(<span class="dv">50329</span>,<span class="dv">66066</span>, <span class="dv">59962</span>, <span class="dv">50530</span>), </span>
<span id="cb8-4"><a href="#cb8-4"></a>                   <span class="dt">male_other =</span> <span class="kw">c</span>(<span class="dv">18099</span>, <span class="dv">18574</span>, <span class="dv">20274</span>, <span class="dv">17709</span>), </span>
<span id="cb8-5"><a href="#cb8-5"></a>                   <span class="dt">female_fulltime =</span> <span class="kw">c</span>(<span class="dv">40054</span>, <span class="dv">53841</span>, <span class="dv">46178</span>, <span class="dv">42198</span>),</span>
<span id="cb8-6"><a href="#cb8-6"></a>                   <span class="dt">female_other =</span> <span class="kw">c</span>(<span class="dv">13781</span>, <span class="dv">14981</span>, <span class="dv">15121</span>, <span class="dv">14422</span>))</span>
<span id="cb8-7"><a href="#cb8-7"></a>df2</span></code></pre></div>
<pre><code>          state male_fulltime male_other female_fulltime female_other
1         Maine         50329      18099           40054        13781
2 Massachusetts         66066      18574           53841        14981
3 New Hampshire         59962      20274           46178        15121
4       Vermont         50530      17709           42198        14422</code></pre>
<p>At first glance, it might seem that we have three variables as in the earlier example, but upon closer examination, we see that we can tease out two variables from the column names: sex (<code>male</code> and <code>female</code>) and work experience (<code>fulltime</code> and <code>other</code>).</p>
<p><img src="img/double_header.PNG" style="width: 73%; height: auto;"></p>
<p><code>pivot_longer</code> has an argument, <code>names_sep</code>, that is passed the character that is used to delimit the two variable values. In our example, this character is <code>_</code>. Since the column values will be split across two variables we will also need to pass <strong>two</strong> column names to the <code>names_to</code> argument.</p>
<p><img src="img/long_to_separate_wide.PNG" style="width: 73%; height: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>df2.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df2, <span class="dt">cols =</span> <span class="op">-</span>state, </span>
<span id="cb10-2"><a href="#cb10-2"></a>                         <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;work&quot;</span>), </span>
<span id="cb10-3"><a href="#cb10-3"></a>                         <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>, </span>
<span id="cb10-4"><a href="#cb10-4"></a>                         <span class="dt">values_to =</span> <span class="st">&quot;income&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>df2.long</span></code></pre></div>
<pre><code># A tibble: 16 x 4
   state         sex    work     income
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male   fulltime  50329
 2 Maine         male   other     18099
 3 Maine         female fulltime  40054
 4 Maine         female other     13781
 5 Massachusetts male   fulltime  66066
 6 Massachusetts male   other     18574
 7 Massachusetts female fulltime  53841
 8 Massachusetts female other     14981
 9 New Hampshire male   fulltime  59962
10 New Hampshire male   other     20274
11 New Hampshire female fulltime  46178
12 New Hampshire female other     15121
13 Vermont       male   fulltime  50530
14 Vermont       male   other     17709
15 Vermont       female fulltime  42198
16 Vermont       female other     14422</code></pre>
</div>
<div id="advanced-pivot_wider-options" class="section level1">
<h1>Advanced <code>pivot_wider</code> options</h1>
<div id="combining-variable-names-when-spreading" class="section level2">
<h2>Combining variable names when spreading</h2>
<p>Continuing with the <code>df2.long</code> dataframe, we can spread the long table back to a wide table while combining the <code>sex</code> and <code>work</code> variables. We’ll add the <code>names_sep</code> argument which defines the character to use to separate the two variable names. We’ll use a dot <code>.</code> separator in this example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">pivot_wider</span>(df2.long, </span>
<span id="cb12-2"><a href="#cb12-2"></a>            <span class="dt">names_from =</span> <span class="kw">c</span>(sex,work), </span>
<span id="cb12-3"><a href="#cb12-3"></a>            <span class="dt">values_from =</span> income,</span>
<span id="cb12-4"><a href="#cb12-4"></a>            <span class="dt">names_sep =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 4 x 5
  state         male.fulltime male.other female.fulltime female.other
  &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1 Maine                 50329      18099           40054        13781
2 Massachusetts         66066      18574           53841        14981
3 New Hampshire         59962      20274           46178        15121
4 Vermont               50530      17709           42198        14422</code></pre>
</div>
<div id="spreading-duplicate-variable-combinations" class="section level2">
<h2>Spreading duplicate variable combinations</h2>
<p>If your long table has more than one unique combination of variables, <code>pivot_wider()</code> will return a list. This differs from the <code>spread()</code>’s behavior which would have returned an error.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">var1 =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>),</span>
<span id="cb14-2"><a href="#cb14-2"></a>                  <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb14-3"><a href="#cb14-3"></a>                  <span class="dt">val  =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb14-4"><a href="#cb14-4"></a>df3</span></code></pre></div>
<pre><code>  var1 var2 val
1    a    x   5
2    a    x   3
3    b    y   1
4    b    y   4</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">pivot_wider</span>(df3, <span class="dt">names_from =</span> var2, <span class="dt">values_from =</span> val)</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  var1  x         y        
  &lt;chr&gt; &lt;list&gt;    &lt;list&gt;   
1 a     &lt;dbl [2]&gt; &lt;NULL&gt;   
2 b     &lt;NULL&gt;    &lt;dbl [2]&gt;</code></pre>
<p>Since the intersections of <code>a</code>:<code>x</code> and <code>b</code>:<code>y</code> each have two possible values, the function returns a <em>list</em> of values. Assuming that the duplicate records are not an erroneous entry, you will need to instruct the function on how to summarize the multiple values using the <code>values_fn</code> argument. For example, to return the maximum value, type:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">pivot_wider</span>(df3, </span>
<span id="cb18-2"><a href="#cb18-2"></a>            <span class="dt">names_from =</span> var2, </span>
<span id="cb18-3"><a href="#cb18-3"></a>            <span class="dt">values_from =</span> val, </span>
<span id="cb18-4"><a href="#cb18-4"></a>            <span class="dt">values_fn =</span> <span class="kw">list</span>(<span class="dt">val =</span> min))</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  var1      x     y
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 a         3    NA
2 b        NA     1</code></pre>
<p>You’ll note the empty cells resulting from there not being a valid combination for <code>a</code>:<code>y</code> and <code>b</code>:<code>x</code>. You can specify the missing values using the <code>values_fill</code> argument. For example, to replace <code>NA</code> with <code>0</code> type:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">pivot_wider</span>(df3, <span class="dt">names_from =</span> var2, <span class="dt">values_from =</span> val, </span>
<span id="cb20-2"><a href="#cb20-2"></a>            <span class="dt">values_fn   =</span> <span class="kw">list</span>(<span class="dt">val =</span> min),</span>
<span id="cb20-3"><a href="#cb20-3"></a>            <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">val =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  var1      x     y
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 a         3     0
2 b         0     1</code></pre>
</div>
</div>
<div id="separating-elements-in-one-column-into-separate-columns" class="section level1">
<h1>Separating elements in one column into separate columns</h1>
<p>The <code>tidyr</code> package offers other functions not directly tied to pivoting. For example, to split a column into two or more columns based on a column’s delimited value, use the <code>separate()</code> function.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Let&#39;s first create a delimited table</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>df2.long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df2, <span class="dt">cols =</span> <span class="dv">-1</span>, </span>
<span id="cb22-3"><a href="#cb22-3"></a>                         <span class="dt">names_to =</span> <span class="st">&quot;var1&quot;</span>, </span>
<span id="cb22-4"><a href="#cb22-4"></a>                         <span class="dt">values_to =</span> <span class="st">&quot;income&quot;</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>df2.long</span></code></pre></div>
<pre><code># A tibble: 16 x 3
   state         var1            income
   &lt;chr&gt;         &lt;chr&gt;            &lt;dbl&gt;
 1 Maine         male_fulltime    50329
 2 Maine         male_other       18099
 3 Maine         female_fulltime  40054
 4 Maine         female_other     13781
 5 Massachusetts male_fulltime    66066
 6 Massachusetts male_other       18574
 7 Massachusetts female_fulltime  53841
 8 Massachusetts female_other     14981
 9 New Hampshire male_fulltime    59962
10 New Hampshire male_other       20274
11 New Hampshire female_fulltime  46178
12 New Hampshire female_other     15121
13 Vermont       male_fulltime    50530
14 Vermont       male_other       17709
15 Vermont       female_fulltime  42198
16 Vermont       female_other     14422</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Split var1 column into two columns</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>df2.sep &lt;-<span class="st"> </span><span class="kw">separate</span>(df2.long, </span>
<span id="cb24-3"><a href="#cb24-3"></a>                    <span class="dt">col =</span> var1, </span>
<span id="cb24-4"><a href="#cb24-4"></a>                    <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, </span>
<span id="cb24-5"><a href="#cb24-5"></a>                    <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;work&quot;</span>))</span>
<span id="cb24-6"><a href="#cb24-6"></a>df2.sep</span></code></pre></div>
<pre><code># A tibble: 16 x 4
   state         sex    work     income
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male   fulltime  50329
 2 Maine         male   other     18099
 3 Maine         female fulltime  40054
 4 Maine         female other     13781
 5 Massachusetts male   fulltime  66066
 6 Massachusetts male   other     18574
 7 Massachusetts female fulltime  53841
 8 Massachusetts female other     14981
 9 New Hampshire male   fulltime  59962
10 New Hampshire male   other     20274
11 New Hampshire female fulltime  46178
12 New Hampshire female other     15121
13 Vermont       male   fulltime  50530
14 Vermont       male   other     17709
15 Vermont       female fulltime  42198
16 Vermont       female other     14422</code></pre>
</div>
<div id="splitting-rows-into-multiple-rows-based-on-delimited-values" class="section level1">
<h1>Splitting rows into multiple rows based on delimited values</h1>
<p>You can also split delimited values across rows.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">separate_rows</span>(df2.long, var1, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 32 x 3
   state         var1     income
   &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male      50329
 2 Maine         fulltime  50329
 3 Maine         male      18099
 4 Maine         other     18099
 5 Maine         female    40054
 6 Maine         fulltime  40054
 7 Maine         female    13781
 8 Maine         other     13781
 9 Massachusetts male      66066
10 Massachusetts fulltime  66066
# ... with 22 more rows</code></pre>
<p>Note that the output is a <code>tibble</code> even if the input is a dataframe.</p>
<div id="replicate-rows-by-count" class="section level2">
<h2>Replicate rows by count</h2>
<p>You can expand rows based on a count column using the <code>uncount()</code> function. This is the opposite of a <code>group_by(...) %&gt;% count()</code> operation that tallies up the observations based on a grouping variable. Here, we’ll replicate rows based on the column <code>count</code> value.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>df2b &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">var1 =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), </span>
<span id="cb28-2"><a href="#cb28-2"></a>                   <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), </span>
<span id="cb28-3"><a href="#cb28-3"></a>                   <span class="dt">count =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a>df2b</span></code></pre></div>
<pre><code>  var1 var2 count
1    a    x     1
2    b    y     3</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">uncount</span>(df2b, count)</span></code></pre></div>
<pre><code>    var1 var2
1      a    x
2      b    y
2.1    b    y
2.2    b    y</code></pre>
<p>If you want to add an index column that identifies the replicated rows, add an <code>.id</code> argument.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">uncount</span>(df2b, count, <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<pre><code>    var1 var2 id
1      a    x  1
2      b    y  1
2.1    b    y  2
2.2    b    y  3</code></pre>
</div>
</div>
<div id="combining-elements-from-many-columns-into-a-single-column" class="section level1">
<h1>Combining elements from many columns into a single column</h1>
<p>Another practical function in the <code>tidyr</code> package is <code>unite()</code>. It combines columns into a single column by chaining the contents of the combined columns. For example, the following table has hours, minutes and seconds in separate columns.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2"></a>      <span class="dt">Index =</span> <span class="kw">c</span>(<span class="dv">1</span>,   <span class="dv">2</span>,  <span class="dv">3</span>),</span>
<span id="cb34-3"><a href="#cb34-3"></a>      <span class="dt">Hour  =</span> <span class="kw">c</span>(<span class="dv">2</span>,  <span class="dv">14</span>, <span class="dv">20</span>),</span>
<span id="cb34-4"><a href="#cb34-4"></a>      <span class="dt">Min   =</span> <span class="kw">c</span>(<span class="dv">34</span>,  <span class="dv">2</span>, <span class="dv">55</span>),</span>
<span id="cb34-5"><a href="#cb34-5"></a>      <span class="dt">Sec   =</span> <span class="kw">c</span>(<span class="dv">55</span>, <span class="dv">17</span>, <span class="dv">23</span>))</span>
<span id="cb34-6"><a href="#cb34-6"></a></span>
<span id="cb34-7"><a href="#cb34-7"></a>df</span></code></pre></div>
<pre><code>  Index Hour Min Sec
1     1    2  34  55
2     2   14   2  17
3     3   20  55  23</code></pre>
<p>To combine the three time elements into a single column, type:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">unite</span>(df,  <span class="dt">col =</span> Time, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">sep=</span><span class="st">&quot;:&quot;</span>, <span class="dt">remove =</span><span class="ot">TRUE</span>)</span>
<span id="cb36-2"><a href="#cb36-2"></a>df2</span></code></pre></div>
<pre><code>  Index     Time
1     1  2:34:55
2     2  14:2:17
3     3 20:55:23</code></pre>
<p>The <code>col</code> parameter defines the new column name; the paremeter <code>2:4</code> tells <code>unite</code> that columns two through four are to be combined into column <code>Time</code>; <code>sep=":"</code> tells the function what characters are to be used to separate the elements (here, we are separating the time elements using <code>:</code>); <code>remove=TRUE</code> tells the function to remove columns two through four.</p>
<div id="creating-unique-combinations-of-variable-values" class="section level2">
<h2>Creating unique combinations of variable values</h2>
<p>You can use <code>expand_grid</code> to automatically generate a table with unique combinations of a set of variable values. For example, to fill a table with a combination of student names and homework assignments, type:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>df3.long &lt;-<span class="st"> </span><span class="kw">expand_grid</span>(</span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="dt">student    =</span> <span class="kw">c</span>(<span class="st">&quot;Joe&quot;</span>, <span class="st">&quot;Jane&quot;</span>, <span class="st">&quot;Kim&quot;</span>),  <span class="co"># Define all unique student names</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="dt">assignment =</span> <span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;HW&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)),     <span class="co"># Define all unique HW assignments</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="dt">value      =</span> <span class="ot">NA</span>)</span>
<span id="cb38-5"><a href="#cb38-5"></a>df3.long</span></code></pre></div>
<pre><code># A tibble: 12 x 3
   student assignment value
   &lt;chr&gt;   &lt;chr&gt;      &lt;lgl&gt;
 1 Joe     HW1        NA   
 2 Joe     HW2        NA   
 3 Joe     HW3        NA   
 4 Joe     HW4        NA   
 5 Jane    HW1        NA   
 6 Jane    HW2        NA   
 7 Jane    HW3        NA   
 8 Jane    HW4        NA   
 9 Kim     HW1        NA   
10 Kim     HW2        NA   
11 Kim     HW3        NA   
12 Kim     HW4        NA   </code></pre>
<p>We can then create a wide version of the table using <code>pivot_wider</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">pivot_wider</span>(df3.long, <span class="dt">names_from =</span> assignment, <span class="dt">values_from =</span> value)</span></code></pre></div>
<pre><code># A tibble: 3 x 5
  student HW1   HW2   HW3   HW4  
  &lt;chr&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 Joe     NA    NA    NA    NA   
2 Jane    NA    NA    NA    NA   
3 Kim     NA    NA    NA    NA   </code></pre>
</div>
<div id="filling-gaps-in-a-table-with-na" class="section level2">
<h2>Filling gaps in a table with <code>NA</code></h2>
<p>It’s not uncommon to be handed a table with incomplete combinations of observations. For example, the following table gives us yield and data source values for each combination of year and grain type. However, several combinations of year/grain are missing.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>df4.long &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">Year  =</span> <span class="kw">c</span>(<span class="dv">1999</span>,<span class="dv">1999</span>,<span class="dv">2000</span>,<span class="dv">2000</span>,<span class="dv">2001</span>,<span class="dv">2003</span>,<span class="dv">2003</span>,<span class="dv">2005</span>),</span>
<span id="cb42-2"><a href="#cb42-2"></a>                        <span class="dt">Grain =</span> <span class="kw">c</span>(<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Corn&quot;</span>,<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Corn&quot;</span>,<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Corn&quot;</span>,<span class="st">&quot;Oats&quot;</span>),</span>
<span id="cb42-3"><a href="#cb42-3"></a>                        <span class="dt">Yield =</span> <span class="kw">c</span>(<span class="dv">23</span>,<span class="dv">45</span>,<span class="dv">24</span>,<span class="dv">40</span>,<span class="dv">20</span>,<span class="dv">19</span>,<span class="dv">41</span>,<span class="dv">22</span>),</span>
<span id="cb42-4"><a href="#cb42-4"></a>                        <span class="dt">Src   =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;a&quot;</span>),</span>
<span id="cb42-5"><a href="#cb42-5"></a>                        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb42-6"><a href="#cb42-6"></a>df4.long</span></code></pre></div>
<pre><code>  Year Grain Yield Src
1 1999  Oats    23   a
2 1999  Corn    45   a
3 2000  Oats    24   b
4 2000  Corn    40   c
5 2001  Oats    20   a
6 2003  Oats    19   a
7 2003  Corn    41   c
8 2005  Oats    22   a</code></pre>
<p>We are missing records for 2001 and Corn, 2003 and Corn, and data for both grains are missing for 2002 and 2004. To add rows for all missing pairs of year/grain values, use the <code>complete</code> function. Here, we’ll assign <code>0</code> to missing <code>Yield</code> values and <code>NA</code> to the <code>Src</code> values.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>df.all &lt;-<span class="st"> </span><span class="kw">complete</span>(df4.long, <span class="dt">Year=</span><span class="dv">1999</span><span class="op">:</span><span class="dv">2005</span>, <span class="dt">Grain=</span>  <span class="kw">c</span>(<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Corn&quot;</span>),</span>
<span id="cb44-2"><a href="#cb44-2"></a>                   <span class="dt">fill =</span> <span class="kw">list</span>(<span class="dt">Yield =</span> <span class="dv">0</span>, <span class="dt">Src =</span> <span class="ot">NA</span>))</span>
<span id="cb44-3"><a href="#cb44-3"></a>df.all</span></code></pre></div>
<pre><code># A tibble: 14 x 4
    Year Grain Yield Src  
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn     45 a    
 2  1999 Oats     23 a    
 3  2000 Corn     40 c    
 4  2000 Oats     24 b    
 5  2001 Corn      0 &lt;NA&gt; 
 6  2001 Oats     20 a    
 7  2002 Corn      0 &lt;NA&gt; 
 8  2002 Oats      0 &lt;NA&gt; 
 9  2003 Corn     41 c    
10  2003 Oats     19 a    
11  2004 Corn      0 &lt;NA&gt; 
12  2004 Oats      0 &lt;NA&gt; 
13  2005 Corn      0 &lt;NA&gt; 
14  2005 Oats     22 a    </code></pre>
<p>If you want to show just the missing rows, use <code>dplyr::anti_join()</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>dplyr<span class="op">::</span><span class="kw">anti_join</span>(df.all, df4.long)</span></code></pre></div>
<pre><code># A tibble: 6 x 4
   Year Grain Yield Src  
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
1  2001 Corn      0 &lt;NA&gt; 
2  2002 Corn      0 &lt;NA&gt; 
3  2002 Oats      0 &lt;NA&gt; 
4  2004 Corn      0 &lt;NA&gt; 
5  2004 Oats      0 &lt;NA&gt; 
6  2005 Corn      0 &lt;NA&gt; </code></pre>
</div>
<div id="identifying-missing-combination-in-dataframes" class="section level2">
<h2>Identifying missing combination in dataframes</h2>
<p>In the previous example, we had the function automatically add the missing combinations using <strong>explicitly</strong> defined ranges of values. If you just want to output the missing combinations from the <strong>existing</strong> set of values in both columns, use the <code>expand()</code> function.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>p.all &lt;-<span class="st"> </span><span class="kw">expand</span>(df4.long, Year, Grain) <span class="co"># List all possible combinations</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>p.all</span></code></pre></div>
<pre><code># A tibble: 10 x 2
    Year Grain
   &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn 
 2  1999 Oats 
 3  2000 Corn 
 4  2000 Oats 
 5  2001 Corn 
 6  2001 Oats 
 7  2003 Corn 
 8  2003 Oats 
 9  2005 Corn 
10  2005 Oats </code></pre>
<p>Note that this only outputs the columns of interest. If you need to see the other columns in the output, perform a join.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>dplyr<span class="op">::</span><span class="kw">left_join</span>(p.all, df4.long, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Grain&quot;</span>))</span></code></pre></div>
<pre><code># A tibble: 10 x 4
    Year Grain Yield Src  
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn     45 a    
 2  1999 Oats     23 a    
 3  2000 Corn     40 c    
 4  2000 Oats     24 b    
 5  2001 Corn     NA &lt;NA&gt; 
 6  2001 Oats     20 a    
 7  2003 Corn     41 c    
 8  2003 Oats     19 a    
 9  2005 Corn     NA &lt;NA&gt; 
10  2005 Oats     22 a    </code></pre>
</div>
<div id="auto-fill-down-or-up" class="section level2">
<h2>Auto-fill down or up</h2>
<p>The <code>fill()</code> function is used to replace <code>NA</code> values with the closest non-<code>NA</code> value in a column. For example, to fill <em>down</em>, set the <code>.direction</code> argument to <code>"down"</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>df5 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Month =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, </span>
<span id="cb52-2"><a href="#cb52-2"></a>                 <span class="dt">Year =</span> <span class="kw">c</span>(<span class="dv">2000</span>, <span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">4</span>),<span class="dv">2001</span>, <span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dv">6</span>)))</span>
<span id="cb52-3"><a href="#cb52-3"></a>df5</span></code></pre></div>
<pre><code>   Month Year
1      1 2000
2      2   NA
3      3   NA
4      4   NA
5      5   NA
6      6 2001
7      7   NA
8      8   NA
9      9   NA
10    10   NA
11    11   NA
12    12   NA</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">fill</span>(df5, Year, <span class="dt">.direction=</span><span class="st">&quot;down&quot;</span>)</span></code></pre></div>
<pre><code>   Month Year
1      1 2000
2      2 2000
3      3 2000
4      4 2000
5      5 2000
6      6 2001
7      7 2001
8      8 2001
9      9 2001
10    10 2001
11    11 2001
12    12 2001</code></pre>
</div>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2020)
</br>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
